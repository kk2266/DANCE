<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pixelated Tie-Dye Spiral</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    min-height: 100vh;
    overflow: hidden;
    background: #111;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Courier New', monospace;
  }
  canvas {
    position: fixed;
    top: 0; left: 0;
    width: 100vw; height: 100vh;
    image-rendering: pixelated;
    image-rendering: crisp-edges;
  }
  .content {
    position: relative;
    z-index: 10;
    text-align: center;
    color: white;
    text-shadow: 0 0 20px rgba(0,0,0,0.8), 0 0 40px rgba(0,0,0,0.6);
  }
  .content h1 {
    font-size: clamp(2rem, 6vw, 5rem);
    letter-spacing: 0.15em;
    text-transform: uppercase;
    margin-bottom: 0.5em;
    animation: glow 3s ease-in-out infinite alternate;
  }
  .content p {
    font-size: clamp(0.9rem, 2vw, 1.4rem);
    opacity: 0.85;
    letter-spacing: 0.3em;
  }
  @keyframes glow {
    from { text-shadow: 0 0 20px rgba(255,255,255,0.3), 0 0 40px rgba(0,0,0,0.6); }
    to   { text-shadow: 0 0 30px rgba(255,255,255,0.6), 0 0 60px rgba(150,50,255,0.4); }
  }
  .controls {
    position: fixed;
    bottom: 20px; right: 20px;
    z-index: 20;
    display: flex; gap: 8px;
  }
  .controls button {
    background: rgba(0,0,0,0.5);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.15);
    color: white;
    padding: 8px 16px;
    border-radius: 8px;
    cursor: pointer;
    font-family: 'Courier New', monospace;
    font-size: 0.75rem;
    letter-spacing: 0.1em;
    transition: all 0.2s;
  }
  .controls button:hover {
    background: rgba(255,255,255,0.15);
    border-color: rgba(255,255,255,0.3);
  }
  .controls button.active {
    background: rgba(255,255,255,0.25);
    border-color: rgba(255,255,255,0.5);
  }

  /* Music notes */
  .music-note {
    position: fixed;
    z-index: 15;
    font-size: 2rem;
    pointer-events: none;
    opacity: 0;
    animation: noteFloat 3s ease-out forwards;
  }
  @keyframes noteFloat {
    0%   { opacity: 1; transform: translateY(0) rotate(0deg) scale(1); }
    50%  { opacity: 0.8; }
    100% { opacity: 0; transform: translateY(-200px) rotate(30deg) scale(0.3); }
  }

  /* Diamond sparkles */
  .diamond {
    position: fixed;
    z-index: 15;
    pointer-events: none;
    opacity: 0;
    animation: diamondPop 1.4s ease-out forwards;
  }
  .diamond::before, .diamond::after {
    content: '';
    position: absolute;
    background: currentColor;
  }
  .diamond::before {
    width: 100%;
    height: 2px;
    top: 50%;
    left: 0;
    transform: translateY(-50%);
    border-radius: 1px;
    box-shadow: 0 0 6px currentColor;
  }
  .diamond::after {
    width: 2px;
    height: 100%;
    left: 50%;
    top: 0;
    transform: translateX(-50%);
    border-radius: 1px;
    box-shadow: 0 0 6px currentColor;
  }
  .diamond-inner {
    position: absolute;
    inset: 30%;
    background: currentColor;
    transform: rotate(45deg);
    box-shadow: 0 0 8px currentColor, 0 0 16px currentColor;
  }
  @keyframes diamondPop {
    0%   { opacity: 0; transform: scale(0) rotate(0deg); }
    20%  { opacity: 1; transform: scale(1.2) rotate(20deg); }
    50%  { opacity: 0.9; transform: scale(0.9) rotate(45deg); }
    100% { opacity: 0; transform: scale(0.3) rotate(90deg); }
  }

  /* Music player bar */
  .player-bar {
    margin-top: 30px;
    background: rgba(0,0,0,0.55);
    backdrop-filter: blur(12px);
    border: 1px solid rgba(255,255,255,0.12);
    border-radius: 12px;
    padding: 10px 16px;
    display: flex;
    align-items: center;
    gap: 10px;
    min-width: 320px;
    max-width: 400px;
    margin-left: auto;
    margin-right: auto;
  }
  .player-bar button {
    background: none;
    border: none;
    color: white;
    cursor: pointer;
    font-size: 0.85rem;
    padding: 2px 4px;
    line-height: 1;
    transition: transform 0.15s, opacity 0.15s;
    opacity: 0.8;
    font-family: inherit;
    letter-spacing: 0.05em;
  }
  .player-bar button:hover {
    transform: scale(1.1);
    opacity: 1;
  }
  .player-title {
    font-size: 0.6rem;
    color: rgba(255,255,255,0.7);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: 90px;
    letter-spacing: 0.05em;
  }
  .player-time {
    font-size: 0.6rem;
    color: rgba(255,255,255,0.5);
    min-width: 32px;
    text-align: center;
    user-select: none;
  }
  .player-slider-wrap {
    flex: 1;
    display: flex;
    align-items: center;
  }
  .player-slider-wrap input[type=range] {
    -webkit-appearance: none;
    appearance: none;
    width: 100%;
    height: 4px;
    border-radius: 2px;
    background: rgba(255,255,255,0.15);
    outline: none;
    cursor: pointer;
  }
  .player-slider-wrap input[type=range]::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: white;
    box-shadow: 0 0 6px rgba(255,255,255,0.4);
    cursor: pointer;
  }
  .player-slider-wrap input[type=range]::-moz-range-thumb {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: white;
    border: none;
    box-shadow: 0 0 6px rgba(255,255,255,0.4);
    cursor: pointer;
  }
  .volume-wrap {
    display: flex;
    align-items: center;
    gap: 4px;
  }
  .volume-wrap input[type=range] {
    -webkit-appearance: none;
    appearance: none;
    width: 50px;
    height: 3px;
    border-radius: 2px;
    background: rgba(255,255,255,0.2);
    outline: none;
    cursor: pointer;
  }
  .volume-wrap input[type=range]::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: white;
    cursor: pointer;
  }
  .volume-wrap input[type=range]::-moz-range-thumb {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: white;
    border: none;
    cursor: pointer;
  }
</style>
</head>
<body>
<canvas id="spiral"></canvas>

<audio id="music" src="PSY - GENTLEMAN M_V.mp3" preload="auto"></audio>

<div class="content">
  <img id="dancer" src="deal-with-it-trailblazer.gif" alt="Deal With It Trailblazer" style="max-width:200px; transition: none;">
  <div class="player-bar">
    <button id="playBtn" onclick="togglePlay()" title="Play/Pause">&#9654;&#65039;</button>
    <span class="player-title" id="trackTitle">PSY - GENTLEMAN</span>
    <span class="player-time" id="curTime">0:00</span>
    <div class="player-slider-wrap">
      <input type="range" id="seekBar" min="0" max="100" value="0" step="0.1">
    </div>
    <span class="player-time" id="durTime">0:00</span>
    <div class="volume-wrap">
      <button id="muteBtn" onclick="toggleMute()" title="Mute">&#9835;</button>
      <input type="range" id="volBar" min="0" max="1" value="1" step="0.01">
    </div>
  </div>
<div class="controls">
  <button id="pixelBtn" onclick="togglePixel()">Pixel: 8px</button>
  <button id="speedBtn" onclick="toggleSpeed()">Speed: Normal</button>
  <button id="modeBtn" onclick="toggleMode()">Mode: Spiral</button>
  <button id="danceBtn" onclick="toggleDance()">Dance: Chill</button>
</div>
<script>
const canvas = document.getElementById('spiral');
const ctx = canvas.getContext('2d');

const colors = [
  [220,20,60],[255,69,0],[255,140,0],[255,200,0],[255,240,0],
  [120,220,20],[0,180,60],[0,180,180],[0,120,220],[30,60,200],
  [100,20,200],[180,20,160]
];
const N = colors.length;

let pixelSize=8, speed=1, mode='spiral', time=0;
const pixelSizes=[4,8,12,16]; let pi=1;
const speeds=[0.5,1,2]; let si=1;
const modes=['spiral','rings','vortex','random']; let mi=0;
const randomCycleDuration = 300; // frames per mode before transitioning

// Dance presets: { scale, rotation, bounceY, bounceX, freqMult }
const dancePresets = [
  { name:'Chill',   scale:0.04, rot:3,  bY:3,  bX:2,  freq:0.6  },
  { name:'Groove',  scale:0.08, rot:5,  bY:6,  bX:4,  freq:1.0  },
  { name:'Hyped',   scale:0.14, rot:10, bY:12, bX:8,  freq:1.6  },
  { name:'Chaos',   scale:0.22, rot:20, bY:24, bX:16, freq:2.5  },
];
let di=0, dance=dancePresets[0];

function resize(){
  canvas.width=Math.ceil(window.innerWidth/pixelSize);
  canvas.height=Math.ceil(window.innerHeight/pixelSize);
}
window.addEventListener('resize',resize); resize();

function getColor(v){
  // Use sin/cos to map value to palette position seamlessly (no seam)
  // This avoids modulo discontinuities
  const angle = v * Math.PI * 2;
  const s = (Math.sin(angle) * 0.5 + 0.5); // 0-1 smooth cycle
  const c = (Math.cos(angle) * 0.5 + 0.5); // 0-1 smooth cycle offset
  // Combine to get a smooth index that wraps without seams
  const idx = ((Math.atan2(Math.sin(angle), Math.cos(angle)) / (Math.PI * 2)) + 1) % 1;
  const pos = idx * N;
  const i = Math.floor(pos);
  const t = pos - i;
  const c1 = colors[i % N], c2 = colors[(i + 1) % N];
  return [c1[0]+(c2[0]-c1[0])*t, c1[1]+(c2[1]-c1[1])*t, c1[2]+(c2[2]-c1[2])*t];
}

function draw(){
  const w=canvas.width, h=canvas.height, cx=w/2, cy=h/2;
  const maxR=Math.sqrt(cx*cx+cy*cy);
  const img=ctx.createImageData(w,h), d=img.data;
  const t = time;

  for(let y=0;y<h;y++) for(let x=0;x<w;x++){
    const dx=x-cx, dy=y-cy;
    const dist=Math.sqrt(dx*dx+dy*dy);
    // Use sin/cos components to avoid atan2 discontinuity
    const sinA = dy / (dist + 0.001);
    const cosA = dx / (dist + 0.001);
    // Reconstruct angle in 0..1 range using atan2, then use trig for color
    const ang = Math.atan2(dy, dx); // -PI to PI

    // Compute each mode's v with integer arms (no seam)
    const noise = Math.sin(x * 0.7 + y * 1.3) * 0.015 + Math.sin(x * 1.1 - y * 0.9) * 0.01;
    const bright = 0.85 + 0.15 * Math.sin(dist * 0.05 + t * 0.01);

    const vSpiral = 1 * ang / (Math.PI * 2) + dist * 0.3 / maxR - t * 0.008 * speed
      + Math.sin(dist * 0.06 - t * 0.012 * speed) * 0.08 + noise;
    const vRings = dist / (maxR * 0.12) - t * 0.025 * speed
      + Math.sin(ang * 8 + t * 0.02 * speed) * 0.01 + noise;
    const vVortex = 3 * ang / (Math.PI * 2) + dist * 0.8 / maxR - t * 0.012 * speed
      + Math.sin(dist * 0.1 + t * 0.02) * 0.06
      + Math.cos(ang * 2 - t * 0.015) * 0.04 + noise;

    function vToRGB(val) {
      const phase = val * Math.PI * 2;
      const idx_s = ((Math.atan2(Math.sin(phase), Math.cos(phase)) / (Math.PI * 2)) + 1.0) % 1.0;
      const pos = idx_s * N;
      const ci = Math.floor(pos);
      const cf = pos - ci;
      const c1 = colors[ci % N], c2 = colors[(ci + 1) % N];
      return [
        Math.min(255, (c1[0]+(c2[0]-c1[0])*cf) * bright),
        Math.min(255, (c1[1]+(c2[1]-c1[1])*cf) * bright),
        Math.min(255, (c1[2]+(c2[2]-c1[2])*cf) * bright)
      ];
    }

    let r, g, b;
    if(mode==='random'){
      const allV = [vSpiral, vRings, vVortex];
      const cycle = t * speed / randomCycleDuration;
      const fromIdx = Math.floor(cycle) % 3;
      const toIdx = (fromIdx + 1) % 3;
      let blend = (cycle % 1);
      blend = blend * blend * (3 - 2 * blend);
      const cF = vToRGB(allV[fromIdx]);
      const cT = vToRGB(allV[toIdx]);
      // Power-curve crossfade: each pattern dims out/in, hiding muddy overlap
      const wF = (1 - blend) * (1 - blend);
      const wT = blend * blend;
      r = cF[0] * wF + cT[0] * wT;
      g = cF[1] * wF + cT[1] * wT;
      b = cF[2] * wF + cT[2] * wT;
    } else {
      const v = mode==='spiral'?vSpiral:mode==='rings'?vRings:vVortex;
      const c = vToRGB(v);
      r = c[0]; g = c[1]; b = c[2];
    }

    const p = (y * w + x) * 4;
    d[p]   = r;
    d[p+1] = g;
    d[p+2] = b;
    d[p+3] = 255;
  }

  ctx.putImageData(img, 0, 0);

  // Sync GIF dance to the same time/speed driving the spiral
  const dancer = document.getElementById('dancer');
  const f = dance.freq;
  const pulse = 1 + dance.scale * Math.sin(time * 0.06 * speed * f);
  const rot = dance.rot * Math.sin(time * 0.04 * speed * f);
  const bounceY = dance.bY * Math.sin(time * 0.08 * speed * f);
  const bounceX = dance.bX * Math.sin(time * 0.05 * speed * f + 1);
  dancer.style.transform =
    `translateY(${bounceY}px) translateX(${bounceX}px) scale(${pulse}) rotate(${rot}deg)`;

  time++;
  requestAnimationFrame(draw);
}

function togglePixel(){
  pi=(pi+1)%pixelSizes.length; pixelSize=pixelSizes[pi]; resize();
  document.getElementById('pixelBtn').textContent='Pixel: '+pixelSize+'px';
}
function toggleSpeed(){
  si=(si+1)%speeds.length; speed=speeds[si];
  document.getElementById('speedBtn').textContent='Speed: '+['Slow','Normal','Fast'][si];
}
function toggleMode(){
  mi=(mi+1)%modes.length; mode=modes[mi];
  document.getElementById('modeBtn').textContent='Mode: '+['Spiral','Rings','Vortex','Random'][mi];
}
function toggleDance(){
  di=(di+1)%dancePresets.length; dance=dancePresets[di];
  document.getElementById('danceBtn').textContent='Dance: '+dance.name;
}

// Audio playback
const music = document.getElementById('music');
const seekBar = document.getElementById('seekBar');
const volBar = document.getElementById('volBar');
const curTimeEl = document.getElementById('curTime');
const durTimeEl = document.getElementById('durTime');
let isPlaying = false, isSeeking = false;
let noteInterval = null;

function fmtTime(s){
  if(!isFinite(s)) return '0:00';
  const m = Math.floor(s/60);
  const sec = Math.floor(s%60);
  return m + ':' + (sec<10?'0':'') + sec;
}

function togglePlay(){
  const btn = document.getElementById('playBtn');
  if(isPlaying){
    music.pause();
    isPlaying = false;
    btn.textContent = '\u25B6';
    stopEffects();
  } else {
    music.play();
    isPlaying = true;
    btn.textContent = '\u2759\u2759';
    startEffects();
  }
}

function toggleMute(){
  music.muted = !music.muted;
  document.getElementById('muteBtn').textContent = music.muted ? '\u2022' : '\u266B';
}

// Seek bar
seekBar.addEventListener('input', ()=>{ isSeeking = true; });
seekBar.addEventListener('change', ()=>{
  music.currentTime = (seekBar.value / 100) * music.duration;
  isSeeking = false;
});
volBar.addEventListener('input', ()=>{ music.volume = volBar.value; });

music.addEventListener('loadedmetadata', ()=>{ durTimeEl.textContent = fmtTime(music.duration); });
music.addEventListener('timeupdate', ()=>{
  if(!isSeeking && isFinite(music.duration)){
    seekBar.value = (music.currentTime / music.duration) * 100;
    curTimeEl.textContent = fmtTime(music.currentTime);
  }
});
music.addEventListener('ended', ()=>{ music.currentTime = 0; music.play(); });

// Effects start/stop
function startEffects(){
  spawnNotes();
}
function stopEffects(){
  clearInterval(noteInterval); noteInterval = null;
}

// Floating music notes
const noteChars = ['\u266A','\u266B','\u266C','\u2669'];
function spawnNotes(){
  if(noteInterval) return;
  noteInterval = setInterval(()=>{
    const note = document.createElement('div');
    note.className = 'music-note';
    note.textContent = noteChars[Math.floor(Math.random()*noteChars.length)];
    note.style.left = (10 + Math.random()*80) + 'vw';
    note.style.bottom = (5 + Math.random()*15) + 'vh';
    note.style.color = `hsl(${Math.random()*360}, 80%, 70%)`;
    note.style.fontSize = (1.2 + Math.random()*1.5) + 'rem';
    document.body.appendChild(note);
    note.addEventListener('animationend', ()=> note.remove());
  }, 400);
}

// Diamond sparkles across screen
let diamondInterval = null;
function spawnDiamonds(){
  if(diamondInterval) return;
  diamondInterval = setInterval(()=>{
    const d = document.createElement('div');
    d.className = 'diamond';
    const size = 10 + Math.random() * 20;
    d.style.width = size + 'px';
    d.style.height = size + 'px';
    d.style.left = (5 + Math.random() * 90) + 'vw';
    d.style.top = (5 + Math.random() * 90) + 'vh';
    d.style.color = `hsl(${Math.random()*360}, 70%, 75%)`;
    const inner = document.createElement('div');
    inner.className = 'diamond-inner';
    d.appendChild(inner);
    document.body.appendChild(d);
    d.addEventListener('animationend', ()=> d.remove());
  }, 300);
}

spawnDiamonds();
draw();
</script>
</body>
</html>
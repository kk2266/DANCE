<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pixelated Tie-Dye Spiral</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    min-height: 100vh;
    overflow: hidden;
    background: #111;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Courier New', monospace;
  }
  canvas {
    position: fixed;
    top: 0; left: 0;
    width: 100vw; height: 100vh;
    image-rendering: pixelated;
    image-rendering: crisp-edges;
  }
  .content {
    position: relative;
    z-index: 10;
    text-align: center;
    color: white;
    text-shadow: 0 0 20px rgba(0,0,0,0.8), 0 0 40px rgba(0,0,0,0.6);
  }
  .content h1 {
    font-size: clamp(2rem, 6vw, 5rem);
    letter-spacing: 0.15em;
    text-transform: uppercase;
    margin-bottom: 0.5em;
    animation: glow 3s ease-in-out infinite alternate;
  }
  .content p {
    font-size: clamp(0.9rem, 2vw, 1.4rem);
    opacity: 0.85;
    letter-spacing: 0.3em;
  }
  @keyframes glow {
    from { text-shadow: 0 0 20px rgba(255,255,255,0.3), 0 0 40px rgba(0,0,0,0.6); }
    to   { text-shadow: 0 0 30px rgba(255,255,255,0.6), 0 0 60px rgba(150,50,255,0.4); }
  }
  .controls {
    position: fixed;
    bottom: 20px; right: 20px;
    z-index: 20;
    display: flex; gap: 8px;
  }
  .controls button {
    background: rgba(0,0,0,0.5);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255,255,255,0.15);
    color: white;
    padding: 8px 16px;
    border-radius: 8px;
    cursor: pointer;
    font-family: 'Courier New', monospace;
    font-size: 0.75rem;
    letter-spacing: 0.1em;
    transition: all 0.2s;
  }
  .controls button:hover {
    background: rgba(255,255,255,0.15);
    border-color: rgba(255,255,255,0.3);
  }
</style>
</head>
<body>
<canvas id="spiral"></canvas>
<div class="content">
  <img id="dancer" src="deal-with-it-trailblazer.gif" alt="Deal With It Trailblazer" style="max-width:200px; transition: none;">
<div class="controls">
  <button id="pixelBtn" onclick="togglePixel()">Pixel: 8px</button>
  <button id="speedBtn" onclick="toggleSpeed()">Speed: Normal</button>
  <button id="modeBtn" onclick="toggleMode()">Mode: Spiral</button>
  <button id="danceBtn" onclick="toggleDance()">Dance: Chill</button>
</div>
<script>
const canvas = document.getElementById('spiral');
const ctx = canvas.getContext('2d');

const colors = [
  [220,20,60],[255,69,0],[255,140,0],[255,200,0],[255,240,0],
  [120,220,20],[0,180,60],[0,180,180],[0,120,220],[30,60,200],
  [100,20,200],[180,20,160]
];
const N = colors.length;

let pixelSize=8, speed=1, mode='spiral', time=0;
const pixelSizes=[4,8,12,16]; let pi=1;
const speeds=[0.5,1,2]; let si=1;
const modes=['spiral','rings','vortex','random']; let mi=0;
const randomCycleDuration = 300; // frames per mode before transitioning

// Dance presets: { scale, rotation, bounceY, bounceX, freqMult }
const dancePresets = [
  { name:'Chill',   scale:0.04, rot:3,  bY:3,  bX:2,  freq:0.6  },
  { name:'Groove',  scale:0.08, rot:5,  bY:6,  bX:4,  freq:1.0  },
  { name:'Hyped',   scale:0.14, rot:10, bY:12, bX:8,  freq:1.6  },
  { name:'Chaos',   scale:0.22, rot:20, bY:24, bX:16, freq:2.5  },
];
let di=0, dance=dancePresets[0];

function resize(){
  canvas.width=Math.ceil(window.innerWidth/pixelSize);
  canvas.height=Math.ceil(window.innerHeight/pixelSize);
}
window.addEventListener('resize',resize); resize();

function getColor(v){
  // Use sin/cos to map value to palette position seamlessly (no seam)
  // This avoids modulo discontinuities
  const angle = v * Math.PI * 2;
  const s = (Math.sin(angle) * 0.5 + 0.5); // 0-1 smooth cycle
  const c = (Math.cos(angle) * 0.5 + 0.5); // 0-1 smooth cycle offset
  // Combine to get a smooth index that wraps without seams
  const idx = ((Math.atan2(Math.sin(angle), Math.cos(angle)) / (Math.PI * 2)) + 1) % 1;
  const pos = idx * N;
  const i = Math.floor(pos);
  const t = pos - i;
  const c1 = colors[i % N], c2 = colors[(i + 1) % N];
  return [c1[0]+(c2[0]-c1[0])*t, c1[1]+(c2[1]-c1[1])*t, c1[2]+(c2[2]-c1[2])*t];
}

function draw(){
  const w=canvas.width, h=canvas.height, cx=w/2, cy=h/2;
  const maxR=Math.sqrt(cx*cx+cy*cy);
  const img=ctx.createImageData(w,h), d=img.data;
  const t = time;

  for(let y=0;y<h;y++) for(let x=0;x<w;x++){
    const dx=x-cx, dy=y-cy;
    const dist=Math.sqrt(dx*dx+dy*dy);
    // Use sin/cos components to avoid atan2 discontinuity
    const sinA = dy / (dist + 0.001);
    const cosA = dx / (dist + 0.001);
    // Reconstruct angle in 0..1 range using atan2, then use trig for color
    const ang = Math.atan2(dy, dx); // -PI to PI

    // Compute v for each mode
    const vSpiral = 1 * ang / (Math.PI * 2) + dist * 0.3 / maxR - t * 0.008 * speed
      + Math.sin(dist * 0.06 - t * 0.012 * speed) * 0.08;
    const vRings = dist / (maxR * 0.12) - t * 0.025 * speed
      + Math.sin(ang * 8 + t * 0.02 * speed) * 0.01;
    const vVortex = 3 * ang / (Math.PI * 2) + dist * 0.8 / maxR - t * 0.012 * speed
      + Math.sin(dist * 0.1 + t * 0.02) * 0.06
      + Math.cos(ang * 2 - t * 0.015) * 0.04;

    let v;
    if(mode==='spiral') v = vSpiral;
    else if(mode==='rings') v = vRings;
    else if(mode==='vortex') v = vVortex;

    // Noise for organic tie-dye texture
    const noise = Math.sin(x * 0.7 + y * 1.3) * 0.015 + Math.sin(x * 1.1 - y * 0.9) * 0.01;
    const bright = 0.85 + 0.15 * Math.sin(dist * 0.05 + t * 0.01);

    // Helper: convert a v value to final RGB
    function vToColor(val) {
      val += noise;
      const phase = val * Math.PI * 2;
      const idx_s = ((Math.atan2(Math.sin(phase), Math.cos(phase)) / (Math.PI * 2)) + 1.0) % 1.0;
      const pos = idx_s * N;
      const ci = Math.floor(pos);
      const cf = pos - ci;
      const c1 = colors[ci % N], c2 = colors[(ci + 1) % N];
      return [
        Math.min(255, (c1[0]+(c2[0]-c1[0])*cf) * bright),
        Math.min(255, (c1[1]+(c2[1]-c1[1])*cf) * bright),
        Math.min(255, (c1[2]+(c2[2]-c1[2])*cf) * bright)
      ];
    }

    let r, g, b;
    if(mode==='random'){
      // Blend final colors (not raw v) to avoid atan2 seam artifacts
      const allV = [vSpiral, vRings, vVortex];
      const cycle = t * speed / randomCycleDuration;
      const fromIdx = Math.floor(cycle) % 3;
      const toIdx = (fromIdx + 1) % 3;
      let blend = (cycle % 1);
      blend = blend * blend * (3 - 2 * blend);
      const cFrom = vToColor(allV[fromIdx]);
      const cTo = vToColor(allV[toIdx]);
      r = cFrom[0] * (1 - blend) + cTo[0] * blend;
      g = cFrom[1] * (1 - blend) + cTo[1] * blend;
      b = cFrom[2] * (1 - blend) + cTo[2] * blend;
    } else {
      const c = vToColor(v);
      r = c[0]; g = c[1]; b = c[2];
    }

    const p = (y * w + x) * 4;
    d[p]   = r;
    d[p+1] = g;
    d[p+2] = b;
    d[p+3] = 255;
  }

  ctx.putImageData(img, 0, 0);

  // Sync GIF dance to the same time/speed driving the spiral
  const dancer = document.getElementById('dancer');
  const f = dance.freq;
  const pulse = 1 + dance.scale * Math.sin(time * 0.06 * speed * f);
  const rot = dance.rot * Math.sin(time * 0.04 * speed * f);
  const bounceY = dance.bY * Math.sin(time * 0.08 * speed * f);
  const bounceX = dance.bX * Math.sin(time * 0.05 * speed * f + 1);
  dancer.style.transform =
    `translateY(${bounceY}px) translateX(${bounceX}px) scale(${pulse}) rotate(${rot}deg)`;

  time++;
  requestAnimationFrame(draw);
}

function togglePixel(){
  pi=(pi+1)%pixelSizes.length; pixelSize=pixelSizes[pi]; resize();
  document.getElementById('pixelBtn').textContent='Pixel: '+pixelSize+'px';
}
function toggleSpeed(){
  si=(si+1)%speeds.length; speed=speeds[si];
  document.getElementById('speedBtn').textContent='Speed: '+['Slow','Normal','Fast'][si];
}
function toggleMode(){
  mi=(mi+1)%modes.length; mode=modes[mi];
  document.getElementById('modeBtn').textContent='Mode: '+['Spiral','Rings','Vortex','Random'][mi];
}
function toggleDance(){
  di=(di+1)%dancePresets.length; dance=dancePresets[di];
  document.getElementById('danceBtn').textContent='Dance: '+dance.name;
}

draw();
</script>
</body>
</html>